\documentclass[12pt]{report}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{url}
\usepackage{color}
\usepackage{fullpage}
%\usepackage{geometry} % see geometry.pdf on how to lay out the page. There's lots.
%\geometry{letterpaper} % or letter or a5paper or ... etc
% \geometry{landscape} % rotated page geometry

% See the ``Article customise'' template for come common customisations

\title{HPS SVT Operations Manual \\ v2.0.1}
\author{SVT On-Call Cell Phone: 757-541-7539 \\ 
Authors: \\
Per Hansson, John Jaros, Takashi Maruyama, Omar Moreno,\\ Tim Nelson\footnote{contact person for this document}, Marco Oriunno, Matt Solt, Sho Uemura}
\date{February 19, 2016} % delete this line to display the current date

%%% BEGIN DOCUMENT
\begin{document}

\maketitle

\tableofcontents

\newpage

\section{Contact List}

\begin{center}
\begin{tabular}{lc}
\hline \hline 
System & Experts \\
\hline
General expert & Tim Nelson \\
Motion and wire scanner & Takashi Maruyama \\
SVT DAQ & Pelle Hansson \\
SVT EPICS controls & Pelle Hansson, Wesley Moore \\
MPOD power supply & Sho Uemura \\
PLC interlocks & Brian Eng \\
Cooling & Sho Uemura \\
 \hline \hline
\end{tabular}
\end{center}

\chapter{System Description}

The SVT, shown in Figure~\ref{fig:SVT}, uses 6 layers of silicon extending from 10 cm to 90 cm downstream of the target inside of the PS vacuum chamber to measure charged particle trajectories.  
%=======================
\begin{figure}[htbp]
\begin{center}
    \includegraphics[width=7cm]{SVT}\includegraphics[width=7cm]{SVT_top}
\caption{The SVT shown inside of the pair spectrometer vacuum chamber.  The beam enters through the flange in the front of the vacuum box extension that houses services for the SVT. }
\label{fig:SVT}
\end{center}
\vspace*{-5mm}
\end{figure}
%=======================
To accommodate the passage of the beam, the SVT is built in two halves, top and bottom, so that each layer consists of a pair of modules, one above and one below the beam plane.  Each module uses silicon microstrip sensors placed back-to-back with a small stereo angle between sides to provide 3-d space points for the hits in a module.  Modules for layer 1-3 have a single sensor on each side with readout at one end, while those for layers 4-6 are longer, with a pair of sensors on each side and readout at both ends.

Modules are supported in groups of three by a set of four support plates, as shown in Figure~\ref{fig:L1-3_bottom}. The top and bottom support plates for the back half of the SVT (layers 4-6) are stationary.  However, the supports for layers 1-3 can be opened and closed vertically around the beam, rotating around hinges behind layer 3 and moved by levers extending upstream to a pair of linear shifts outside of the magnet. The support plates are kinematically mounted inside a support box that installs into the pair spectrometer (PS) vacuum chamber, shown in Figure~\ref{fig:SVT_Box}.
%=======================
\begin{figure}[htpb]
\subfigure[\label{fig:L1-3_bottom}The lower support plate for Layers 1-3, showing the silicon (red) and readout electronics (green) of the modules, as well as the motion lever for opening and closing the SVT and the SVT beam scan wires.]
{\includegraphics[width=6.5cm]{L1-3_bottom}}
\hspace{0.5cm}
\subfigure[\label{fig:SVT_Box}The SVT support box which contains the upper and lower support plates for Layers 1-3 and Layers 4-6, as well as the cooling plate housing the Front End Boards of the SVT DAQ.]
{\includegraphics[width=6.5cm]{SVT_Box}}
\caption{Key sub-assemblies of the SVT.}
\end{figure}
%=======================

The first stage of readout electronics is located on a hybrid circuit board at the end of each sensor.  Multiplexed analog signals from these boards are digitized by a set of 10 Front End Boards (FEBs) mounted to a separate cooling plate inside the SVT support box. Each FEB can control 4 hybrid/sensor units: a single module in layers 4-6 and either one or two modules in layers 1-3. The FEBs also control the hybrids, provide regulated low-voltage power from a single input, and pass externally generated bias voltages (HV) through to the sensors.   The FEBs communicate with a set of 4 Signal Flange Boards (SFB), up to three per SFB, which transmit digital signals through the vacuum penetration.  The exterior side of each flange board converts digital to optical signals for communication with the RCE DAQ.  Power to the FEB are routed through a pair of Power Flange Boards, one for LV and one for HV, supplied by Wiener MPOD power supply modules in a crate on the pie-tower.

Cooling for the SVT is provided by a pair of chillers; one for the hybrids and sensors that operate at -20 $^\circ$C and one for the FEBs that operates at room temperature.  The FEBs have a single cooling loop, while the hybrids and sensors have two loops, one for the top and one for the bottom half of the SVT, where each of these loops runs first through the support structure for layers 1-3 and then through the structure for layers 4-6.  There are temperature sensors on every hybrid as well as sensors in the FEBs. The linear shifts, the cooling penetrations, and the signal/power penetrations are all located on a set of flanges on an extension vacuum box mounted to the upstream end of the PS vacuum chamber and which connects to the upstream beam line.

Since the SVT sensors are close to the beam, some attention to beam conditions is required prior to turning the SVT on and taking data. A number of systems provide the information used to assess whether beam conditions allow SVT operation. These systems include beam position monitors along the beamline, wire scanners located upstream of the HPS chicane, the wire attached to the SVT itself, a protection collimator located just upstream of the HPS chicane, and beam halo counters located along the beamline downstream of the collimator and signals from the HPS ECal which serve together as beam background monitors.  A detailed description of these systems and their operation can be found in the Beamline Operations Manual.



\section{Voltages}
The power and bias needed to operate the SVT is supplied by low voltage and high voltage power supply modules inside a 10-slot Wiener MPOD crate, see Fig.~\ref{fig:ec_crate}. 
\begin{figure}
\begin{center}
\includegraphics[width=10cm]{ec_create.png}
\caption{\label{fig:ec_crate}The Wiener power supply crate for the SVT.}
\end{center}
\end{figure}
The crate is located in a rack in the pie tower with PTFE (teflon) insulated twisted pair copper wires used to bring power to the SVT in the Hall-B alcove. 

The low voltage power is supplied by Wiener MPV8008I low voltage power supply modules. Each module has 8 output channels (floating, with sense lines).
Each of the five modules supplies power to two FEBs. 

ISEG EHS F201p\_805F high precision high voltage modules provide the reverse bias voltage to the silicon sensors of the SVT. Each module has 16 output channels (floating). The three modules each supply bias to 12 sensors: SVT L1-3, L4-6 top or L4-6 bottom.  

The last two slots in the crate are occupied by spare modules (one LV and one HV).

\subsection{Control and Monitoring}
The SVT power supply and bias is fully controlled through GUIs to the EPICS control system. 
EPICS controls the MPOD crate directly through its SNMP interface which supply the FEBs with power. 
The FEBs regulate and distribute power down to the hybrid boards of the SVT sensor modules. 
The control and monitoring of the hybrid power (and temperature) is handled by an EPICS IOC running on the SVT DAQ crate. 

%It is important to note that having cooling running is a prerequisite for any power being supplied to the SVT and configuration of the FEB are prerequisite for powering any hybrids.
Both cooling systems must be running before the MPOD can be turned on; this is enforced by an interlock. 
Also, the FEBs must be configured before any hybrids can be powered.

\section{Cooling and Interlocks}
The SVT cooling system, summarized in Table~\ref{tab:cooling} and Figure~\ref{fig:cooling_diagram}, controls the temperature of the sensors and removes heat dissipated by the electronics. 
%===================
\begin{table}[ht]
\begin{center}
\begin{tabular}{lccc}   
\hline \hline 
Location & Set Point & Resistive Load & Radiative Load \\      
\hline
SVT modules & -10 $^\circ$C & 75 W & 10 W  \\
Piping to SVT modules & -20 $^\circ$C & 100 W & 0 \\
Set point, SVT chiller & -20 $^\circ$C & - & - \\
Front End Boards & 25 $^\circ$C & 100 W & 0  \\
Set point, FEB chiller & 20 $^\circ$C & - & - \\
 \hline \hline
\end{tabular}
\caption[]{SVT cooling design parameters.}
\label{tab:cooling} 
\end{center}
\end{table}
%===================
%=======================
\begin{figure}[htbp]
\begin{center}
    \includegraphics[width=\textwidth]{cooling_diagram}
\caption{The SVT cooling system.}
\label{fig:cooling_diagram}
\end{center}
\end{figure}
%=======================
Since the SVT is in vacuum, the cooling system is key for the safety and performance of the detector. The main heat sources are the sensor modules and their hybrid circuit boards and the Front End Boards (FEBs) which distribute power and DAQ to reduce the number of wires that must penetrate the vacuum flanges. An additional heat load results from the radiative heat exchange between the SVT U-support and the detector vacuum. The sensor modules need to be controlled to a sub-zero temperature, while the FEBs needs to be only thermally managed, removing the heat dissipated and keeping the active components to safe temperature, slightly above room temperature. For this reason it has been decided to have two separate chillers with independent loops and controls. The dew point in Hall B is expected to be at $\sim$18 $^\circ$C. The cold line from the sensor chiller to the vacuum box is insulated with 1 inch thick, non-flammable Armaflex.

All the instrumentation to control the cooling system will be placed in air, close to the chillers, with an identical layout for the two, as shown in Figures~\ref{fig:cooling_diagram}. 

The cooling loop for the sensor modules is connected to a Julabo Chiller, Model Presto A80, which is set at -20 $^\circ$C. The heat transfer fluid is HFE-7000, a Fluorinert engineered fluid long used as heat transfer media for cooling applications.
The inlet and the outlet lines are split to provide cooling in parallel to the top and the bottom parts of the detector.
They then pass through flanges on the detector vacuum box, where they provide cooling in series to the L1-3 and L4-6 parts of the detector. The cooling pipes in vacuum are flexible metal hoses from the vacuum feed through to the detector, while the cooling lines built in the detector are 0.25" rigid copper pipe. The flexible lines are brazed on one end to the rigid copper pipes of the detectors and connected with VCR fittings to the vacuum feedthroughs on the other end. The cooling feed through have a ceramic transition spool to insulate electrically the cooling line from the vacuum box. Dielectric fittings to break the electrical continuity of the cooling loop are placed outside the vacuum.
The estimated operating mass flow of the system is $\sim$10 g/s, providing 5 g/s per cooling channel with a pressure drop $\sim$1 bar.  The cooling loop inside vacuum is pneumatically tested up to 20 bars without showing any sign of failure.

For the SVT chiller: Two Pt100 temperature sensors are located at the supply and return sides of the SVT manifold (glued to the tee junctions). Two mechanical pressure gauges are located at the supply and return sides of the SVT manifold, just before the tee junctions. A piston flow switch at the return side of the chiller (fixed setpoint of 0.25 GPM) checks that the flow going to the detector is acceptable. A check valve after the flow switch prevents a leak in the cooling loop from draining the chiller. A servo-actuated ball valve at the outlet of the chiller stops the cooling flow when requested by the slow control system (this valve takes $\sim$5 seconds to open or close). A pulsation dampener at the outlet of the chiller absorbs vibrations from the pump. The temperature sensors and the flow meter are interfaced with the Slow Control as diagnostic, while the actuated ball valve valve is interlocked. Additional diagnostics are available through the temperature sensors built into the SVT modules and the functional parameters of the chiller like set point temperature and pump pressure, which are controlled through an RS232 software interface.

The FEB cooling plate has a similar cooling loop, which connects to a similar vacuum feedthrough on the front face of the vacuum chamber. The cooling fluid is deionized water. Two Pt100 temperature sensors are glued to the cooling lines next to the feedthrough. A paddlewheel flow switch (adjustable setpoint, normally 6-15 GPH) at the return side of the chiller checks that the flow going to the detector is acceptable; a rotameter is connected in series to measure the flow rate. A check valve after the flow switch prevents a leak in the cooling loop from draining the chiller. A solenoid valve at the outlet of the chiller stops the cooling flow when requested by the slow control system. The temperature sensors and the flow meter are interfaced with the Slow Control as diagnostic, while the solenoid valve is interlocked. Additional diagnostics are available through the temperature sensors built into the FEBs and the functional parameters of the chiller like set point temperature, which are controlled through an RS232 software interface.

\subsection{Sensors and inputs}
\subsubsection*{FEB cooling loop}
\begin{itemize}
    \item To PLC: Flow switch (adjustable setpoint, set around 10 GPH with reference to flow meter) at chiller return
    \item To PLC: 2x RTD on supply and return, near vacuum feedthroughs
    \item Through SVT DAQ: temperature sensors on FEBs
    \item From FEB chiller (via RS-232): temperature readout, status
    \item Local readout only: flow meter, next to flow switch
\end{itemize}
\subsubsection*{SVT cooling loop}
\begin{itemize}
    \item To PLC: Flow switch (fixed setpoint, 0.25 GPM) at chiller return
    \item To PLC: 2x RTD on supply and return, at manifold (before lines split to top and bottom halves of the SVT)
    \item Through SVT DAQ: temperature sensors on hybrids
    \item From SVT chiller (via RS-232): temperature readout, outlet pressure, status
    \item Local readout only: 2x pressure gauges, on supply and return at manifold
\end{itemize}

The sensors with PLC or RS-232 readout are monitored through the EPICS slow controls system and displayed in the monitoring GUIs for the chillers and the PLC.
The SVT alarm handler has alarms defined for the temperatures: see the SVT monitoring section.

\subsection{Control outputs}
The PLC and chillers can be controlled through EPICS. These control outputs can be used in PLC or EPICS interlocks.
\subsubsection*{FEB cooling loop}
\begin{itemize}
    \item From PLC: Solenoid valve at chiller outlet
    \item On FEB chiller (via RS-232): start/stop, temperature setpoint, pump speed
\end{itemize}
\subsubsection*{SVT cooling loop}
\begin{itemize}
    \item From PLC: Actuated ball valve at chiller outlet
    \item From PLC: Chiller circuit breaker
    \item On SVT chiller (via RS-232): start/stop, temperature setpoint, pump power
\end{itemize}
\subsubsection*{Voltages}
\begin{itemize}
    \item From PLC: MPOD enable signal (shuts down all LV and HV channels)
    \item From MPOD IOC: Controls for individual MPOD channels
\end{itemize}



\subsection{Interlocks}
\label{sec:svt_power_monitoring_alarm_interlocks}

To safely operate the SVT, the power supplies are included in an interlock system that triggers a fast shutdown of the power supply crate based on a set of conditions. A schematic view of the interlock system that triggers a SVT power supply interlock signal is shown in Fig.~\ref{fig:svt_interlock_diagram}. 
\begin{figure}
\includegraphics[width=10cm]{svt_interlock_diagram}
\caption{Diagram of the SVT interlocks.\label{fig:svt_interlock_diagram}}
\end{figure}
The interlock system is based on an Allen-Bradley PLC that receives input signals and performs the necessary logic to issue an interlock signal. The interlock signal that triggers a fast shutdown of the SVT power supplies are:
\begin{itemize}
\item Hybrid and front end board temperature
\item Input and output coolant temperature of the SVT hybrid and front end board cooling loops.
\item Coolant fluid pressure in the SVT hybrid and front end board cooling loops.
\item Chiller setting and status of the SVT and hybrid and front end board chillers.
\end{itemize}
 Each power control interface (flange board, front-end board, hybrid, bias) shows the status of the interlock signal that allows each system to be powered. 

The solenoid valves are interlocked to mitigate any leaks in the cooling system. 
If the flow meter in either cooling loop detects low flow, the valve at that chiller's outlet closes to prevent coolant from being pumped out of a possible leak in that loop. 
If the vacuum gauge detects a loss of vacuum, both solenoid valves close in case the vacuum loss is due to a coolant leak inside vacuum.

\subsection{Potential accidents}
\subsubsection*{Coolant leakage inside vacuum}
A small leak inside the vacuum will be detected by the vacuum gauges. A large leak will trip the flow switch.
\subsubsection*{Coolant leakage outside vacuum}
A small leak will drain the chiller until its level switch trips, then the flow switch will trip. A large leak will trip the flow switch.
\subsubsection*{Low level in SVT cooling system}
The HFE 7000 fluid is very volatile and is known to evaporate from the chiller reservoir. Any bad seals in the system would increase the rate of loss. The observed rate of loss in testing is less than 1 L/week, and the reservoir capacity is more than 5 L, but the level should be monitored regularly. A low level warning (reported in RS-232 status) will precede a low level alarm (chiller trip).
\subsubsection*{Chiller failure or abnormal operation}
A pump or power failure in a chiller will trip the flow switch.

A refrigerator or control failure may cause the chiller to run at an unexpected temperature. This would be detected by the RTDs.
\subsubsection*{Blockage in a cooling line}
A blockage in the FEB cooling loop, or the SVT cooling lines before the manifold, would reduce total flow in the system. This would be detected by the flow switch or the RTD on the return side.

A blockage in one half of the SVT cooling manifold would reduce flow to half the SVT but might not be detectable by any of the cooling loop instrumentation. The only likely indication is a rise in the SVT hybrid temperatures. Since we don't expect this to happen suddenly or require rapid intervention, we will set an alarm on the SVT hybrid temperatures but no interlock.
\subsubsection*{Beam trip}
The SVT HV must be shut off following a trip, to ensure that the HV is not accidentally left on while the beam is being brought back.

\subsection{Interlocks for operation with beam}
All interlock actions are triggered by PLC inputs. Actions are divided into PLC (fast and reliable, since the inputs, logic and outputs are all internal to the PLC) and EPICS (slower, less reliable, less critical)
\subsubsection{Cooling loop failure (high or low temperature on either RTD, or flow switch trip)}
Trip points must be adjustable to allow for operation at different temperatures. There must be some sort of interlock bypass for system startup (i.e. it must be possible to start the chiller when temperatures are out of spec and the flow switch is tripped).
\begin{itemize}
    \item PLC interlock action: Close the valve at the chiller outlet. Disable the MPOD.
    \item Software interlock action: Turn off the chiller.
\end{itemize}

\subsubsection{Bad vacuum (vacuum gauge)}
\begin{itemize}
    \item PLC and software interlock actions: Same action as cooling loop failure, for both loops. (so chillers will be valved off and shut off, and the MPOD will be disabled)
\end{itemize}

\subsubsection{Beam off (BPM signal)}
%There should be an option to have a PLC interlock that disables the MPOD.
If the beam is lost, the SVT should automatically go to a safe configuration until beam is restored.
\begin{itemize}
\item Software interlock action: Turn off all HV channels.
\end{itemize}

\section{Motion}
\begin{figure}[ht!]
\centering
\includegraphics[width=15cm]{motion.eps}
\caption{SVT Motion System}
\label{fig:motion}
\end{figure}

Figure~\ref{fig:motion} shows the SVT Motion System schematically. The top/bottom of each SVT support plate has three sensor layers (L1, L2, L3) and a wire frame, supported on a bearing at one end and connected to a rod attached to a linear stage at the other end. The linear stage is moved by a stepper motor through the EPICS slow controls system. In the nominal run position, the support plates are parallel to the beam and the Silicon physical edge is at 0.5 (L1), 2.0 (L2), and 3.5 mm (L3) from the beam. The support plates can be retracted by 1.3 degrees. Figure~\ref{fig:beam} shows the beam's eye view of the wires and the L1 sensor edge in the nominal run position and in the fully retracted position.

The stepper motor controller is Newport XPS controller, and is different from the stepper motor controllers found in Hall B. The motor control is based on an optical encoder. Stage movement is precisely calibrated, and re-calibration is not necessary. Since the encoder has no knowlege of the actual stage position when the controller power is turned on, the linear stage must move to a reference point to establish its calibration (called ``homing''). A switch is located at the fully retracted position for this purpose. 

Three vertical coordinates are used to locate the stage, the horizontal wire and the layer 1 sensor physical edge. The stage coordinate is y(stage) = 0~mm at the fully retracted position and y(top stage) = 18.136 mm  and y(bottom stage) = 18.212 mm at the nominal run position with the silicon 0.5~mm from the nominal beam plane. The wire and sensor edge coordinates are measured relative to the nominal beam position (positive y is up), and are given in terms of y(stage) as,

When the beam is first delivered to Hall B, the vertical position of the beam is known to about 1 mm. Since we want to place the SVT layer 1 physical edge at 0.5 mm from the beam, SVT Wire Scanner is used to measure the beam position relative to the sensor edge with a precision of about 50~$\mu$m. The wire scanner has a 20 $\mu$m diameter gold-plated tungsten horizontal wire and a 30 $\mu$m diameter gold-plated tungsten angled wire. The angled wire is at 8.904 degrees to the horizontal wire, and is separated by y=1.98 mm at the nominal beam position. The Y position of the beam can be measured directly from the horizontal wire. If $\Delta$Y is the apparent Y position difference of the measured beam ``gaussian'' centers, the X position of the beam can be obtained from X = ($\Delta$Y - 1.98)/tan(8.904).   

\begin{itemize}
\item
y(top-wire) = -0.482 $\cdot$ y(stage) + 1.218 mm,
\item
y(top-si) = -0.391 $\cdot$ y(stage) + 7.472 mm,
\item
y(bottom-wire) = +0.463 $\cdot$ y(stage) - 0.684 mm,
\item
y(bottom-si) = +0.363 $\cdot$ y(stage) - 6.815 mm.
\end{itemize}

As the coordinate transformation is done automatically, all you need to specify is the position of the wire or Si sensor edge to operate the SVT Mover and the SVT Wire Scanner. 

\begin{figure}[ht!]
\centering
\includegraphics[width=15cm]{WireFrame2.pdf}
\caption{Beam's eye view of wires and and L1 sensor edge}
\label{fig:beam}
\end{figure}




\chapter{Controls and monitoring}

\section{Voltages}
\label{sec:monitoring_power}
The MPOD power supply crate can be accessed directly by pointing a web browser at \url{http://hpsmpod/}. This shows channel voltages, currents and status directly.

The SVT power and bias as well as alarms are monitored through several GUI's. All GUI's are accessible from the main HPS control screen. To start it:

\begin{enumerate}
\item Log into any computer in the counting house.

\begin{figure}[ht!]
\centering
\includegraphics[width=3cm]{epics_dev_svt.png}
\caption{HPS EPICS main GUI. \label{fig:hps_epics_svt}}
\end{figure}

\item Open a terminal and issue \texttt{hps\_epics} command to open the main HPS GUI. Figure~\ref{fig:hps_epics_svt} show the SVT part of the GUI open.
\item Each of the individual GUIs can be opened by clicking the appropriate button in the HPS main GUI that opened.
\end{enumerate}

Below is a description of each of the GUI's in the list.

\begin{figure}[ht!]
\centering
\includegraphics[width=8cm]{svtDaqIOCStatus.png}
\caption{DAQ IOC Status GUI. \label{fig:svtDaqIOCStatus}}
\end{figure}

\begin{itemize}
\item \textbf{DAQ IOC Status} in Fig.~\ref{fig:svtDaqIOCStatus}.
\begin{itemize}
\item Monitoring: status and error codes from all SVT DAQ IOCs.
\end{itemize}

\item \textbf{DPM Status} in Fig.~\ref{fig:svtDpmStatus}.
\begin{itemize}
\item Monitoring: run state and event counts  from the data processing nodes in the SVT DAQ.
\end{itemize}

\begin{figure}[ht!]
\centering
\includegraphics[width=8cm]{svtDpmStatus.png}
\caption{DPM state GUI. \label{fig:svtDpmStatus}}
\end{figure}

\begin{figure}[hb!]
\centering
\includegraphics[width=13cm]{svtDpmLinkStatus.png}
\caption{DPM link status GUI. \label{fig:svtDpmLinkStatus}}
\end{figure}

\item \textbf{DPM  Link Status} in Fig.~\ref{fig:svtDpmLinkStatus}.
\begin{itemize}
\item Monitoring: link errors for each of the data processing nodes in the SVT DAQ.
\end{itemize}

\item \textbf{Temperature} in Fig.~\ref{fig:svtTemp}.
\begin{itemize}
\item Monitoring: FEB (3 temperatures), 
\item Monitoring: FEB cooling temperature on the supply and return at the PS magnet for the FEB and SVT chiller.
\end{itemize}

\item \textbf{Hybrid GUI} in Fig.~\ref{fig:svtHybrid}.
\begin{itemize}
\item Monitoring: all measured voltage and currents from hybrids. 
\item Monitoring: temperature from hybrids. 
\item Control: ON/OFF switch for each of the three voltages for individual hybrids and all hybrids.
\end{itemize}

\begin{figure}[ht!]
\centering
\includegraphics[width=5cm]{svtTemp.png}
\caption{Temperature GUI. \label{fig:svtTemp}}
\end{figure}

\begin{figure}[hb!]
\centering
\includegraphics[width=13cm]{svtHybrid.png}
\caption{Hybrid power and temperature GUI. \label{fig:svtHybrid}}
\end{figure}

\item \textbf{Hybrid Sync} in Fig.~\ref{fig:svtHybridSync}.
\begin{itemize}
\item Monitoring: sync status for each hybrid.
\item Monitoring: base and peak value of the sync pulse from each hybrid. (EXPERT ONLY). 
\end{itemize}

\begin{figure}[ht!]
\centering
\includegraphics[width=14cm]{svtHybridSync.png}
\caption{Hybrid sync GUI. \label{fig:svtHybridSync}}
\end{figure}

\item \textbf{FEB Power GUI} in Fig.~\ref{fig:svtFebMain}.
\begin{itemize}
\item Monitoring: all currents and voltages of the FEB.
\item Control: ON/OFF switch for all FEB boards. 
\item Control: ON/OFF switch for each FEB board. 
\item Control: Set point for voltage, trip and ramp values for each flange board (EXPERT ONLY).
\end{itemize}

\item \textbf{Flange power GUI} in Fig.~\ref{fig:svtFlange}.
\begin{itemize}
\item Monitoring: all  currents to the flange boards. 
\item Control: ON/OFF switch for all flange boards. 
\item Control: ON/OFF switch for each flange board. 
\item Control: Set point for voltage, trip and ramp values for each flange board (EXPERT ONLY).
\end{itemize}

\item \textbf{High voltage bias GUI} in Fig.~\ref{fig:svtBias}.
\begin{itemize}
\item Monitoring: all voltage set points for the SVT sensors.
\item Control: ON/OFF switch for all sensors.
\item Control: ON/OFF switch for each sensor.
\item Control: Set point for voltage for all modules (EXPERT ONLY).
\item Control: Set point for voltage and ramp values for each module (EXPERT ONLY).
\item Control: \textbf{RESET INTERLOCKS} button to restore normal function after an MPOD trip.
\end{itemize}



\end{itemize}

\begin{figure}[h!t]
\centering
\includegraphics[width=14cm]{svtFebMain.png}
\caption{FEB power GUI. \label{fig:svtFebMain}}
\end{figure}

\begin{figure}[h!t]
\centering
\includegraphics[width=14cm]{svtFlange.png}
\caption{Flange power GUI. \label{fig:svtFlange}}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=14cm]{svtBias.png}
\caption{High voltage bias GUI. \label{fig:svtBias}}
\end{figure}

\input{svt_chiller_controls.tex}

\section{Motion}
The SVT motor controller can be accessed directly by pointing a web browser at \url{http://hpsxps/} (SVT expert should know the login).

The SVT movers are controlled using the SVT positioner GUI.
The GUI controls the top and bottom halves of the SVT separately.
For each half, the GUI shows the position in four ways: stage position, wire-to-beam distance, layer-1-to-beam distance, and angle. Except for the stage position (0 at home, positve as the stage moves in), these are signed values (positive above the beamline, negative under it).

\begin{figure}[h!t!]
\centering
\includegraphics[width=8cm]{svt_movers.png}
\caption{SVT positioner GUI, accessed through the \textbf{Motors} menu in \textbf{hps\_epics}.}
\label{mover}
\end{figure}


The \textbf{Retract Stage} button moves the stage to 0.000 (all the way out).
The button is disabled (red border) if this half of the SVT is already all the way out.

The \textbf{Move Layer-1 to} text box moves the SVT to user-defined positions.
Type the desired (signed) value of the layer-1 distance and press \textbf{Enter} to move the stage.
There is a software limit (a minimum layer-1 distance) to prevent unsafe operation of the SVT. The limits is not displayed on this GUI but are 17.95~mm and 17.54~mm for the top and bottom respectively.  These positions correspond to placing the edge of the Layer 1 sensors 0.45~mm from the beam plane.

\emph{Sometimes there is no response to an input in the text box. If this happens, one workaround is to open the motor expert GUI (click the \textbf{Expert Screens} button), and enter a value in either \textbf{MoveAbs} field. This seems to kick the motor control out of whatever bad state it gets stuck in.}

\begin{figure}[ht!]
\centering
\includegraphics[width=10cm]{svt_wirescan_gui}
\caption{SVT wire scan GUI}
\label{scannergui}
\end{figure}

\input{svt_online_monitoring.tex}


\chapter{Procedures}


\section{General Procedures}
\label{sec:proc_general_beamchecklist}

\subsection{Powering the SVT}
\label{sec:proc_voltages}

\subsubsection{Turning the SVT power and bias ON}
\label{sec:proc_voltages_allon}
The SVT sensor bias (HV) and the low voltage (LV) needed to control and read out the detector are essentially independent.  However, the various components powered by the LV supplies; the Flanges, the FEBs and the Hybrids; depend upon one another, so they be powered on in proper order to operate the detector.  In particular, the Flanges must be powered to communicate with the FEBs and the FEBs must be powered in order to either power or communicate with the Hybrids. To power ON all of the SVT follow this procedure using the SVT summary GUI, shown in Figure~\ref{fig:svt_summary_gui}.
%=======================
\begin{figure}[htbp]
\begin{center}
    \includegraphics[width=\textwidth]{svt_summary_gui.png}
\caption{SVT summary GUI.}
\label{fig:svt_summary_gui}
\end{center}
\vspace*{-5mm}
\end{figure}
%=======================
\begin{enumerate}
\item Make sure that the SVT and FEB chillers are \textbf{ON} and \textbf{OK}, and the PLC interlock is \textbf{enabled} and \textbf{OK}. See Sec.~\ref{sec:proc_cooling} for operation of the cooling system.  Check that the SVT and FEB supply and return temperatures under \texttt{Temperature Status} are as expected.
\item Turn on SVT Flange Power by pressing the \texttt{ALL SVT FLANGE} \textbf{ON} button and wait for the status indicator to turn green.
\item Turn on the SVT FEB Power by pressing the \texttt{FEB ALL} \textbf{ON} buttong and wait for the status indicators to turn green and the FEB heartbeat to begin.
\item Turn on the SVT Hybrids Power by pressing the \texttt{ALL HYBRIDS} \textbf{ON} button and wait for the status indicators to turn green.
\item Turn on the SVT Sensor HV Power by pressing the \texttt{ALL SVT BIAS} \textbf{ON} button and wait for the status indicator to turn green.
\item Reset the Beam Interlock by pressing the \texttt{BEAM INTERLOCK} \textbf{RESET} button under \texttt{ALL HV CONTROL}, then the \texttt{180V} button.
\end{enumerate}

If any status indicator fails to turn green during this procedure or any action results in an alarm, check that the \texttt{IOC Status} is green and call the SVT Expert.  More detailed information on the status of the system can be found in the various expert GUIs that can be opened from the summary GUI.

\subsubsection{Turning the SVT power and bias OFF}
\label{sec:proc_voltages_alloff}
To power OFF all of the SVT follow this procedure:
\begin{enumerate}
\item Turn off the SVT Sensor HV Power by pressing the \texttt{ALL SVT BIAS} \textbf{OFF} button and wait for the status indicator to turn red.
\item Turn off SVT Flange Power by pressing the \texttt{ALL SVT FLANGE} \textbf{OFF} button and wait for the status indicator to turn red.
\item Turn off the SVT FEB Power by pressing the \texttt{FEB ALL} \textbf{OFF} button and wait for the status indicators for both the FEB and Hybrid power to turn red.
\end{enumerate}

If any status indicator fails to turn green during this procedure or any action results in an alarm, check that the \texttt{IOC Status} is green and call the SVT Expert.  More detailed information on the status of the system can be found in the various expert GUIs that can be opened from the summary GUI.

\subsection{Bringing Beam to the Tagger Dump}
Very often the SVT will be operating, running tests or calibration, during periods when there is no beam in Hall B. However, because of the potential for damaging sensitive SVT electronics with beam splash while bringing beam to the tagger dump after downtimes, power to the SVT must be turned off before beam is brought into the hall:  
\begin{itemize}
\item flange power off
\item FEB/hybrid power off
\item HV off
\end {itemize}
In addition, the SVT must be fully retracted from the beam and the SVT collimator should be set up as directed in the shift instructions.  \textbf{Don't assume that just because the SVT expert is present that the SVT is in the correct state. You must ensure that the SVT is in the correct state before bringing beam into the hall.}

\subsection{Bringing Beam through the Chicane}
%If the run plan calls for moving the SVT in for physics running, the SVT Expert should be called when beam is first brought through the chicane. 
SVT power should remain off until after beam has been successfully brought through the chicane and wire scans at 2H02 (and with the SVT wires, if so instructed) have been performed that establish that the beam is in the expected position. Before turning on the SVT, the status of the following systems must be checked:

\begin{itemize}
\item Check that the SVT is fully retracted from the beam
\item Check that the SVT collimator is set up as described in the shift instructions
\item Check that all PLC and software interlocks are enabled (in particular, make sure the beam interlock is enabled).
\item Check that all temperatures are within limits and that all interlock statuses are clear
\end{itemize}

Once these conditions have been met, power to the SVT may be restored to prepare for running, following the procedure detailed in the DAQ manual.
%\begin{enumerate}
%\item turn on  SVT FEB power
%\item turn on  SVT flange power
%\item check that FEBs are powered correctly
%\item turn on SVT hybrid power
%\end{enumerate}

%\item Check that voltages are on.
%\item Check the SVT soft limits: Open the SVT positioner GUI. For each half of the SVT, open the \textbf{Motor Expert Gui} (under \textbf{Expert Screens}) and check the \textbf{Hi limit} against the shift instructions.
%%\item Check the SVT shift instructions for ``Before Beam'' settings.
%\item Set the beam interlock: {\color{red} doesn't exist yet}
%\end{enumerate}

\subsection{Setting up for running with beam}
\label{sec:proc_general_startrun}
If this is the first run after setting up beam for HPS, the SVT will be open and the SVT Expert will need to be called in order to move the SVT into position. The experts-only procedure for establishing 0.5 mm running with the SVT may be found in Section~\ref{sec:proc_svt_0.5mm}.  To begin a run:
\begin{enumerate}
\item Turn on power to the SVT following the \textbf{Turning the SVT power and bias ON} procedure, in Section~\ref{sec:proc_voltages_allon}.
\item Start a run with the DAQ (see the "SVT Checklist" in the \textbf{Start and stop a run} section of the DAQ Operations Manual).
\end{enumerate}

\subsection{Moving the SVT to 0.5 mm for Physics Running - \textbf{EXPERT ONLY}}
\label{sec:proc_svt_0.5mm}

If this is the first run after setting up beam for HPS, follow this procedure for moving the SVT to 0.5 mm.
\begin{enumerate}
\item Establish running with SVT at +/-1.5mm, as usual.  Verify good data with monitoring plots.
\item Check the following:
\begin{itemize}
\item Acceptable beam at Faraday cup (see run plan for the definition of acceptable beam).
\item Beam is centered with respect to the SVT, either using SVT wire scans (see procedure in Section \ref{sec:wirescan}) or by taking a 2H02 wire scan and comparing with 2H02 wire scan from the last time the beam was centered with respect to the SVT.
\item Halo counter FSD is unmasked, and trip level is set appropriately for the current halo counter rate.
\item HPS orbit locks are on, and orbit lock target positions are as specified in the run plan.
\item MCC has been notified to not restore beam following a halo counter FSD trip.
\end{itemize}
\item Start new run.  Move in Bottom SVT 0.1 mm at a time.  Watch strip charts and record with each move:
\begin{itemize}
\item FSD counter rate
\item SVT L1b HV currents
\item Peak occupancy in L1b
\end{itemize}
\item Stop if FSD trips, peak occupancy exceeds 4\%, or any SVT HV currents exceed 1 uA.
\item If Bottom SVT makes it to 0.5 mm, retract Bottom SVT to 1.5mm and repeat previous steps for Top SVT.
\item If both top and bottom come all the way to 0.5mm acceptably, then bring bottom back to 0.5mm and begin running with a new run.
\end{enumerate}

If either half of the SVT does not make it to 0.5 mm, consultation will be required in order to decide whether to move the beam slightly and where exactly we should run the SVT.  If necessary, running at 0.6 mm or 0.7 mm may be acceptable.

\subsection{Running the SVT}

When running the SVT at 0.5 mm:
\begin{itemize}
\item Check the scaler strip charts often
\item Check the L1 HV currents often.  Call expert if they exceed the levels indicated in the shift instructions.
\item Check the occupancy plots at the beginning of each run and at least once per hour.  Call the SVT expert if they exceed 4\% anywhere in L1.
\item For beam trips, follow the special procedure in Section~\ref{sec:proc_general_beamtrip} that applies to running with the SVT at 0.5 mm.
\end{itemize}

\subsection{Response to beam trip}
\label{sec:proc_general_beamtrip}
If the beam is lost, the SVT software interlock \textbf{may} lower the HV and open the SVT.  In general, for beam trips:
\begin{enumerate}
\item Check the SVT shift instructions to see if any special actions are required.
\item \textbf{If SVT is at 0.5 mm, check the FSD GUI to see if our halo counters were responsible. If so, follow the FSD trip procedure (below) instead of continuing with this one.}
%\item \textit{If the HV interlock was enabled:} \textbf{(default is enabled)} Look at the SVT Summary GUI and verify that \textbf{BIAS ALL V\_SET} column reads as expected \textbf{(default is 5V)} and the status indicator is red.
%\item \textit{If the motion interlock was enabled} \textbf{(default is disabled)}: Look at the Scaler GUI, and verify that the \textbf{Position} of the top and bottom read 0.0000.
\item On the SVT Summary GUI, the \texttt{ALL SVT BIAS} status indicator should remain green as the bias voltage stays at 180V.
\item When beam is restored, check that the BPM x and y values at 2H02 are as desired and that beam current is stable at our desired value.
%\item Reset the beam interlock by pressing the \texttt{BEAM INTERLOCK} \textbf{RESET} button.
%\item Press the \texttt{BIAS ALL V\_SET} \textbf{180V} button to turn on the SVT Sensor HV and wait for the \texttt{ALL SVT BIAS} status indicator to turn green.
%\item Reset the SVT monitoring plots (disconnect and connect). Check the SVT monitoring plots.
\end{enumerate}

\subsubsection{Response to beam trip (FSD trip)}
\label{sec:proc_fsd_beamtrip}

\textbf{When taking physics runs with the SVT in  the nominal position, 0.5 mm from the beam plane, the silicon in Layer 1 is not fully protected by the collimator.  In this case, the following procedure must be followed for beam trips where the halo counter FSD is responsible:}
\begin{enumerate}
%\item Check the FSD GUI to determine if the HPS halo counters generated the trip.
%\item If the beam trip was not caused by the HPS halo counter:
%\begin {enumerate}
%\item The MCC will restore the beam as usual.
%\item When it is restored, check that the BPM x and y values at 2H02 are as desired and that beam current is stable at our desired value.
%\item Then reset the SVT HV and resume the run.
%\end{enumerate}
%\item If the HPS halo counters initiated the trip:
%\begin{enumerate}
\item Tell the MCC not to restore the beam. We will inform them when we want it.
%\item Retract the SVT to 1.5 mm, both top and bottom.
\item On the SVT Summary GUI, the \texttt{ALL SVT BIAS} status indicator should turn yellow as the bias voltage is ramping down. It will turn red once the bias voltage is at 5V. If this does not happen after about 10 seconds, manually press the \texttt{BIAS ALL V\_SET} \textbf{5V} button.
\item Once the status indicator turns red, tell the MCC we are ready for beam.
\item When restored, check that the BPM x and y values at 2H02 are as defined in the orbit locks and that halo counter rates are the same as before the trip.
\item Reset the beam interlock by pressing the \texttt{BEAM INTERLOCK} \textbf{RESET} button.
\item Press the \texttt{BIAS ALL V\_SET} \textbf{180V} button to turn on the SVT Sensor HV and wait for the \texttt{ALL SVT BIAS} status indicator to turn green.
\item Wait until beam current is stable at our desired value.
%\item Move SVT in by steps (to 1.0, then 0.7, then 0.5 mm). 
%\item At each step, watch the FSD signal scaler and the bias currents. If the FSD signal scaler rate rises by more than 10\% or any bias current rises by more than 1 uA above the levels at 1.5 mm, call the SVT expert.
\item Reset the SVT monitoring plots (disconnect and connect). Check the SVT monitoring plots.
%\end{enumerate}
\end{enumerate}


\section{Response to Alarms}

The alarm handling is handled by the ALH extension to EPICS that is widely used at JLab. The SVT alarm handling GUI is shown in Fig.~\ref{fig:svt_alarm_gui}. It is tree-based with each level showing more detailed info of what alarm has gone off. 
\begin{figure}[ht]
\includegraphics[width=12cm]{svt_alarm_gui}
\caption{SVT alarm handler GUI.\label{fig:svt_alarm_gui}}
\end{figure}

Each level has two buttons: a \textbf{guidance} button which opens a pop up display with more information and an \textbf{action} button which acknowledges the alarm. 

\begin{verbatim}
In case any error please contact SVT expert.
\end{verbatim}
\begin{verbatim}
Be ready to report what alarm has gone off.
\end{verbatim}

More information about the alarm handler can be found in the slow control manual. 

\input{svt_chiller_procedures.tex}

\section{Motion}

\subsection{SVT Mover Operations}

Figure \ref{mover} shows the SVT Mover GUI.
The web interface to the motor controller (\url{http://hpsxps/}) can be used to initialize and home the stages, or reboot the controller.

\begin{itemize}
\item
Type in the destination of the layer 1 edge in mm in \textbf{Desired Layer-1 Position}, and hit Enter. Alternatively, press one of the buttons below (\textbf{3.0}, \textbf{1.5}, \textbf{1.0}, \textbf{0.7}, \textbf{0.5}).
\item Press the \textbf{MOVE} button to command the move.
\item Press \textbf{Retract Stage} at any time to fully retract the SVT (this will also abort a move in progress).
\end{itemize}

The positions of the stage, wire and Layer 1 sensor edge, and the angle away from horizontal, are shown in their respective coordinates.

\subsection{SVT Wire Scanner Operations}
\label{sec:wirescan}

To center the beam, perform SVT wire scans (if the top and bottom are known to be consistent, only use the same set of wires that was used in the last good scan in the logbook; otherwise use both top and bottom, and take the mean) and correct if you see $|y_{beam}| > 50$ $\mu$m or $|x_{beam}| > 300$ $\mu$m.

Once the beam offset values ($\Delta$X, $\Delta$Y) from the nominal beam position are measured, request MCC to move the beam using corrector magnets (MBC2H04V/H and MBC2H08V/H). Wire scan should be repeated to confirm the beam position.

A wire scan can be performed from the SVT wire scan GUI (Figure \ref{scannergui}). To open the GUI, first open the SVT positioners GUI (Figure \ref{mover}). Click the \textbf{Expert Screens} button for the top or bottom half of the SVT, then select the scan GUI from the menu.

\begin{itemize}
\item Check:
\begin{itemize}
\item
MCC is not moving the beam or changing beam conditions.
\item
Ask MCC to mask BOM and Downstream Halo Counter in FSD.
%\item
%SVT power is turned off.
%\item
%ECal is operational.
\item
Downstream halo counters are operational.
\end{itemize}
\item
Click \textbf{SCAN} to start a scan using the default settings.
\item
Watch the SVT positioners GUI to see the stage position move. When it reaches the end of the scan and starts moving back to 0, you can click the \textbf{Analyze the data} button to analyze the data. This will pop up some plots and automatically submit a logentry.
\end{itemize}

The wire scan analyzer output is shown in Figure \ref{scanneroutput}. The analyzer looks at two halo counters (HPS\_T and HPS\_SC), finds the peaks from the two wires, and does an initial fit to constant background plus Gaussian (solid fit curves), and a second fit to the center of the peak (dotted fit curves). Normally all four sets of fit results (numbers on the right) should be similar. The beam X and Y positions are given in the SVT coordinate system, where (0,0) is the nominal beam position.

\begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{svt_wirescan_output}
\caption{SVT wire scan output}
\label{scanneroutput}
\end{figure}
%\appendix

\end{document}
